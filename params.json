{
  "name": "Express-winston",
  "tagline": "express.js middleware for flatiron/winston",
  "body": "# express-winston\r\n[![Monthly Downloads](https://img.shields.io/npm/dm/express-winston.svg)](https://www.npmjs.com/package/express-winston) [![Build Status](https://secure.travis-ci.org/bithavoc/express-winston.png)](http://travis-ci.org/bithavoc/express-winston)\r\n\r\n> [winston](https://github.com/flatiron/winston) middleware for express.js\r\n\r\n## Installation\r\n\r\nNewcomers should start with the latest branch which makes use of winston 1.x.x and supports node >= 0.10:\r\n\r\n    npm install express-winston\r\n\r\nIf you're already using express-winston, and want to stick with the stable version based on winston 0.9.x, you should instead do:\r\n\r\n    npm install express-winston@0.x.x --save\r\n\r\n## Usage\r\n\r\nexpress-winston provides middlewares for request and error logging of your express.js application.  It uses 'whitelists' to select properties from the request and (new in 0.2.x) response objects.\r\n\r\nTo make use of express-winston, you need to add the following to your application:\r\n\r\nIn `package.json`:\r\n\r\n```\r\n{\r\n  \"dependencies\": {\r\n    \"...\": \"...\",\r\n    \"winston\": \"0.6.x\",\r\n    \"express-winston\": \"0.2.x\",\r\n    \"...\": \"...\"\r\n  }\r\n}\r\n```\r\n\r\nIn `server.js` (or wherever you need it):\r\n\r\n```\r\nvar winston = require('winston'),\r\n    expressWinston = require('express-winston');\r\n```\r\n\r\n### Request Logging\r\n\r\nUse `expressWinston.logger(options)` to create a middleware to log your HTTP requests.\r\n\r\n``` js\r\n    var router = require('./my-express-router');\r\n\r\n    app.use(expressWinston.logger({\r\n      transports: [\r\n        new winston.transports.Console({\r\n          json: true,\r\n          colorize: true\r\n        })\r\n      ],\r\n      meta: true, // optional: control whether you want to log the meta data about the request (default to true)\r\n      msg: \"HTTP {{req.method}} {{req.url}}\", // optional: customize the default logging message. E.g. \"{{res.statusCode}} {{req.method}} {{res.responseTime}}ms {{req.url}}\"\r\n      expressFormat: true, // Use the default Express/morgan request formatting, with the same colors. Enabling this will override any msg and colorStatus if true. Will only output colors on transports with colorize set to true\r\n      colorStatus: true, // Color the status code, using the Express/morgan color palette (default green, 3XX cyan, 4XX yellow, 5XX red). Will not be recognized if expressFormat is true\r\n      ignoreRoute: function (req, res) { return false; } // optional: allows to skip some log messages based on request and/or response\r\n    }));\r\n\r\n    app.use(router); // notice how the router goes after the logger.\r\n```\r\n\r\n#### Options\r\n\r\n``` js\r\n    transports: [<WinstonTransport>], // list of all winston transports instances to use.\r\n    winstonInstance: <WinstonLogger>, // a winston logger instance. If this is provided the transports option is ignored.\r\n    level: String, // log level to use, the default is \"info\".\r\n    msg: String // customize the default logging message. E.g. \"{{res.statusCode}} {{req.method}} {{res.responseTime}}ms {{req.url}}\", \"HTTP {{req.method}} {{req.url}}\".\r\n    expressFormat: Boolean, // Use the default Express/morgan request formatting, with the same colors. Enabling this will override any msg and colorStatus if true. Will only output colors on transports with colorize set to true\r\n    colorStatus: Boolean, // Color the status code, using the Express/morgan color palette (default green, 3XX cyan, 4XX yellow, 5XX red). Will not be recognized if expressFormat is true\r\n    meta: Boolean, // control whether you want to log the meta data about the request (default to true).\r\n    baseMeta: Object, // default meta data to be added to log, this will be merged with the meta data.\r\n    metaField: String, // if defined, the meta data will be added in this field instead of the meta root object.\r\n    statusLevels: Boolean or Object // different HTTP status codes caused log messages to be logged at different levels (info/warn/error), the default is false. Use an object to control the levels various status codes are logged at.\r\n    ignoreRoute: function (req, res) { return false; } // A function to determine if logging is skipped, defaults to returning false. Called _before_ any later middleware.\r\n    skip: function(req, res) { return false; } // A function to determine if logging is skipped, defaults to returning false. Called _after_ response has already been sent.\r\n    requestFilter: function (req, propName) { return req[propName]; } // A function to filter/return request values, defaults to returning all values allowed by whitelist. If the function returns undefined, the key/value will not be included in the meta.\r\n    responseFilter: function (res, propName) { return res[propName]; } // A function to filter/return response values, defaults to returning all values allowed by whitelist. If the function returns undefined, the key/value will not be included in the meta.\r\n    requestWhitelist: [String] // Array of request properties to log. Overrides global requestWhitelist for this instance\r\n    responseWhitelist: [String] // Array of response properties to log. Overrides global responseWhitelist for this instance\r\n    bodyWhitelist: [String] // Array of body properties to log. Overrides global bodyWhitelist for this instance\r\n    bodyBlacklist: [String] // Array of body properties to omit from logs. Overrides global bodyBlacklist for this instance\r\n    ignoredRoutes: [String] // Array of paths to ignore/skip logging. Overrides global ignoredRoutes for this instance\r\n\r\n```\r\n\r\n### Error Logging\r\n\r\nUse `expressWinston.errorLogger(options)` to create a middleware that log the errors of the pipeline.\r\n\r\n``` js\r\n    var router = require('./my-express-router');\r\n\r\n    app.use(router); // notice how the router goes first.\r\n    app.use(expressWinston.errorLogger({\r\n      transports: [\r\n        new winston.transports.Console({\r\n          json: true,\r\n          colorize: true\r\n        })\r\n      ]\r\n    }));\r\n```\r\n\r\nThe logger needs to be added AFTER the express router(`app.router)`) and BEFORE any of your custom error handlers(`express.handler`). Since express-winston will just log the errors and not __handle__ them, you can still use your custom error handler like `express.handler`, just be sure to put the logger before any of your handlers.\r\n\r\n#### Options\r\n\r\n``` js\r\n    transports: [<WinstonTransport>], // list of all winston transports instances to use.\r\n    winstonInstance: <WinstonLogger>, // a winston logger instance. If this is provided the transports option is ignored\r\n    msg: String // customize the default logging message. E.g. \"{{res.statusCode}} {{req.method}} {{res.responseTime}}ms {{req.url}}\", \"HTTP {{req.method}} {{req.url}}\".\r\n    baseMeta: Object, // default meta data to be added to log, this will be merged with the error data.\r\n    metaField: String, // if defined, the meta data will be added in this field instead of the meta root object.\r\n    requestFilter: function (req, propName) { return req[propName]; } // A function to filter/return request values, defaults to returning all values allowed by whitelist. If the function returns undefined, the key/value will not be included in the meta.\r\n    requestWhitelist: [String] // Array of request properties to log. Overrides global requestWhitelist for this instance\r\n    level: String // custom log level for errors (default is 'error')\r\n```\r\n\r\nTo use winston's existing transports, set `transports` to the values (as in key-value) of the `winston.default.transports` object. This may be done, for example, by using underscorejs: `transports: _.values(winston.default.transports)`.\r\n\r\nAlternatively, if you're using a winston logger instance elsewhere and have already set up levels and transports, pass the instance into expressWinston with the `winstonInstance` option. The `transports` option is then ignored.\r\n\r\n## Examples\r\n\r\n``` js\r\n    var express = require('express');\r\n    var expressWinston = require('express-winston');\r\n    var winston = require('winston'); // for transports.Console\r\n    var app = module.exports = express();\r\n\r\n    app.use(express.bodyParser());\r\n    app.use(express.methodOverride());\r\n\r\n    // Let's make our express `Router` first.\r\n    var router = express.Router();\r\n    router.get('/error', function(req, res, next) {\r\n      // here we cause an error in the pipeline so we see express-winston in action.\r\n      return next(new Error(\"This is an error and it should be logged to the console\"));\r\n    });\r\n\r\n    app.get('/', function(req, res, next) {\r\n      res.write('This is a normal request, it should be logged to the console too');\r\n      res.end();\r\n    });\r\n\r\n    // express-winston logger makes sense BEFORE the router.\r\n    app.use(expressWinston.logger({\r\n      transports: [\r\n        new winston.transports.Console({\r\n          json: true,\r\n          colorize: true\r\n        })\r\n      ]\r\n    }));\r\n\r\n    // Now we can tell the app to use our routing code:\r\n    app.use(router);\r\n\r\n    // express-winston errorLogger makes sense AFTER the router.\r\n    app.use(expressWinston.errorLogger({\r\n      transports: [\r\n        new winston.transports.Console({\r\n          json: true,\r\n          colorize: true\r\n        })\r\n      ]\r\n    }));\r\n\r\n    // Optionally you can include your custom error handler after the logging.\r\n    app.use(express.errorLogger({\r\n      dumpExceptions: true,\r\n      showStack: true\r\n    }));\r\n\r\n    app.listen(3000, function(){\r\n      console.log(\"express-winston demo listening on port %d in %s mode\", this.address().port, app.settings.env);\r\n    });\r\n```\r\n\r\nBrowse `/` to see a regular HTTP logging like this:\r\n\r\n    {\r\n      \"req\": {\r\n        \"httpVersion\": \"1.1\",\r\n        \"headers\": {\r\n          \"host\": \"localhost:3000\",\r\n          \"connection\": \"keep-alive\",\r\n          \"accept\": \"*/*\",\r\n          \"user-agent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_4) AppleWebKit/536.11 (KHTML, like Gecko) Chrome/20.0.1132.57 Safari/536.11\",\r\n          \"accept-encoding\": \"gzip,deflate,sdch\",\r\n          \"accept-language\": \"en-US,en;q=0.8,es-419;q=0.6,es;q=0.4\",\r\n          \"accept-charset\": \"ISO-8859-1,utf-8;q=0.7,*;q=0.3\",\r\n          \"cookie\": \"connect.sid=nGspCCSzH1qxwNTWYAoexI23.seE%2B6Whmcwd\"\r\n        },\r\n        \"url\": \"/\",\r\n        \"method\": \"GET\",\r\n        \"originalUrl\": \"/\",\r\n        \"query\": {}\r\n      },\r\n      \"res\": {\r\n        \"statusCode\": 200\r\n      },\r\n      \"responseTime\" : 12,\r\n      \"level\": \"info\",\r\n      \"message\": \"HTTP GET /favicon.ico\"\r\n    }\r\n\r\nBrowse `/error` will show you how express-winston handles and logs the errors in the express pipeline like this:\r\n\r\n    {\r\n      \"date\": \"Thu Jul 19 2012 23:39:44 GMT-0500 (COT)\",\r\n      \"process\": {\r\n        \"pid\": 35719,\r\n        \"uid\": 501,\r\n        \"gid\": 20,\r\n        \"cwd\": \"/Users/thepumpkin/Projects/testExpressWinston\",\r\n        \"execPath\": \"/usr/local/bin/node\",\r\n        \"version\": \"v0.6.18\",\r\n        \"argv\": [\r\n          \"node\",\r\n          \"/Users/thepumpkin/Projects/testExpressWinston/app.js\"\r\n        ],\r\n        \"memoryUsage\": {\r\n          \"rss\": 14749696,\r\n          \"heapTotal\": 7033664,\r\n          \"heapUsed\": 5213280\r\n        }\r\n      },\r\n      \"os\": {\r\n        \"loadavg\": [\r\n          1.95068359375,\r\n          1.5166015625,\r\n          1.38671875\r\n        ],\r\n        \"uptime\": 498086\r\n      },\r\n      \"trace\": [\r\n        ...,\r\n        {\r\n          \"column\": 3,\r\n          \"file\": \"Object].log (/Users/thepumpkin/Projects/testExpressWinston/node_modules/winston/lib/winston/transports/console.js\",\r\n          \"function\": \"[object\",\r\n          \"line\": 87,\r\n          \"method\": null,\r\n          \"native\": false\r\n        }\r\n      ],\r\n      \"stack\": [\r\n        \"Error: This is an error and it should be logged to the console\",\r\n        \"    at /Users/thepumpkin/Projects/testExpressWinston/app.js:39:15\",\r\n        \"    at callbacks (/Users/thepumpkin/Projects/testExpressWinston/node_modules/express/lib/router/index.js:272:11)\",\r\n        \"    at param (/Users/thepumpkin/Projects/testExpressWinston/node_modules/express/lib/router/index.js:246:11)\",\r\n        \"    at pass (/Users/thepumpkin/Projects/testExpressWinston/node_modules/express/lib/router/index.js:253:5)\",\r\n        \"    at Router._dispatch (/Users/thepumpkin/Projects/testExpressWinston/node_modules/express/lib/router/index.js:280:4)\",\r\n        \"    at Object.handle (/Users/thepumpkin/Projects/testExpressWinston/node_modules/express/lib/router/index.js:45:10)\",\r\n        \"    at next (/Users/thepumpkin/Projects/testExpressWinston/node_modules/express/node_modules/connect/lib/http.js:204:15)\",\r\n        \"    at done (/Users/thepumpkin/Dropbox/Projects/express-winston/index.js:91:14)\",\r\n        \"    at /Users/thepumpkin/Dropbox/Projects/express-winston/node_modules/async/lib/async.js:94:25\",\r\n        \"    at [object Object].log (/Users/thepumpkin/Projects/testExpressWinston/node_modules/winston/lib/winston/transports/console.js:87:3)\"\r\n      ],\r\n      \"req\": {\r\n        \"httpVersion\": \"1.1\",\r\n        \"headers\": {\r\n          \"host\": \"localhost:3000\",\r\n          \"connection\": \"keep-alive\",\r\n          \"cache-control\": \"max-age=0\",\r\n          \"user-agent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_4) AppleWebKit/536.11 (KHTML, like Gecko) Chrome/20.0.1132.57 Safari/536.11\",\r\n          \"accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\",\r\n          \"accept-encoding\": \"gzip,deflate,sdch\",\r\n          \"accept-language\": \"en-US,en;q=0.8,es-419;q=0.6,es;q=0.4\",\r\n          \"accept-charset\": \"ISO-8859-1,utf-8;q=0.7,*;q=0.3\",\r\n          \"cookie\": \"connect.sid=nGspCCSzH1qxwNTWYAoexI23.seE%2B6WhmcwdzFEjqhMDuIIl3mAUY7dT4vn%2BkWvRPhZc\"\r\n        },\r\n        \"url\": \"/error\",\r\n        \"method\": \"GET\",\r\n        \"originalUrl\": \"/error\",\r\n        \"query\": {}\r\n      },\r\n      \"level\": \"error\",\r\n      \"message\": \"middlewareError\"\r\n    }\r\n\r\n## Global Whitelists and Blacklists\r\n\r\nExpress-winston exposes three whitelists that control which properties of the `request`, `body`, and `response` are logged:\r\n\r\n* `requestWhitelist`\r\n* `bodyWhitelist`, `bodyBlacklist`\r\n* `responseWhitelist`\r\n\r\nFor example, `requestWhitelist` defaults to:\r\n\r\n    ['url', 'headers', 'method', 'httpVersion', 'originalUrl', 'query'];\r\n\r\nOnly those properties of the request object will be logged. Set or modify the whitelist as necessary.\r\n\r\nFor example, to include the session property (the session data), add the following during logger setup:\r\n\r\n    expressWinston.requestWhitelist.push('session');\r\n\r\nThe blacklisting excludes certain properties and keeps all others. If both `bodyWhitelist` and `bodyBlacklist` are set\r\nthe properties excluded by the blacklist are not included even if they are listed in the whitelist!\r\n\r\nExample:\r\n\r\n    expressWinston.bodyBlacklist.push('secretid', 'secretproperty');\r\n\r\nNote that you can log the whole request and/or response body:\r\n\r\n    expressWinston.requestWhitelist.push('body');\r\n    expressWinston.responseWhitelist.push('body');\r\n\r\n## Route-Specific Whitelists and Blacklists\r\n\r\nNew in version 0.2.x is the ability to add whitelist elements in a route.  express-winston adds a `_routeWhitelists` object to the `req`uest, containing `.body`, `.req` and .res` properties, to which you can set an array of 'whitelist' parameters to include in the log, specific to the route in question:\r\n\r\n``` js\r\n    router.post('/user/register', function(req, res, next) {\r\n      req._routeWhitelists.body = ['username', 'email', 'age']; // But not 'password' or 'confirm-password' or 'top-secret'\r\n      req._routeWhitelists.res = ['_headers'];\r\n    });\r\n```\r\n\r\nPost to `/user/register` would give you something like the following:\r\n\r\n    {\r\n      \"req\": {\r\n        \"httpVersion\": \"1.1\",\r\n        \"headers\": {\r\n          \"host\": \"localhost:3000\",\r\n          \"connection\": \"keep-alive\",\r\n          \"accept\": \"*/*\",\r\n          \"user-agent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_4) AppleWebKit/536.11 (KHTML, like Gecko) Chrome/20.0.1132.57 Safari/536.11\",\r\n          \"accept-encoding\": \"gzip,deflate,sdch\",\r\n          \"accept-language\": \"en-US,en;q=0.8,es-419;q=0.6,es;q=0.4\",\r\n          \"accept-charset\": \"ISO-8859-1,utf-8;q=0.7,*;q=0.3\",\r\n          \"cookie\": \"connect.sid=nGspCCSzH1qxwNTWYAoexI23.seE%2B6Whmcwd\"\r\n        },\r\n        \"url\": \"/\",\r\n        \"method\": \"GET\",\r\n        \"originalUrl\": \"/\",\r\n        \"query\": {},\r\n        \"body\": {\r\n          \"username\": \"foo\",\r\n          \"email\": \"foo@bar.com\",\r\n          \"age\": \"72\"\r\n        }\r\n      },\r\n      \"res\": {\r\n        \"statusCode\": 200\r\n      },\r\n      \"responseTime\" : 12,\r\n      \"level\": \"info\",\r\n      \"message\": \"HTTP GET /favicon.ico\"\r\n    }\r\n\r\nBlacklisting supports only the `body` property.\r\n\r\n\r\n``` js\r\n    router.post('/user/register', function(req, res, next) {\r\n      req._routeWhitelists.body = ['username', 'email', 'age']; // But not 'password' or 'confirm-password' or 'top-secret'\r\n      req._routeBlacklists.body = ['username', 'password', 'confirm-password', 'top-secret'];\r\n      req._routeWhitelists.res = ['_headers'];\r\n    });\r\n```\r\n\r\nIf both `req._bodyWhitelist.body` and `req._bodyBlacklist.body` are set the result will be the white listed properties\r\nexcluding any black listed ones. In the above example, only 'email' and 'age' would be included.\r\n\r\n\r\n## Custom Status Levels\r\n\r\nIf you set statusLevels to true express-winston will log sub 400 responses at info level, sub 500 responses as warnings and 500+ responses as errors. To change these levels specify an object as follows\r\n```json\r\n  \"statusLevels\": {\r\n    \"success\": \"debug\",\r\n    \"warn\": \"debug\",\r\n    \"error\": \"info\"\r\n  }\r\n```\r\n\r\n## Tests\r\n\r\nRun the basic Mocha tests:\r\n\r\n    npm test\r\n\r\nRun the Travis-CI tests (which will fail with < 100% coverage):\r\n\r\n    npm run test-travis\r\n\r\nGenerate the `coverage.html` coverage report:\r\n\r\n    npm run test-coverage\r\n\r\n## Issues and Collaboration\r\n\r\nIf you ran into any problems, please use the project [Issues section](https://github.com/bithavoc/express-winston/issues) to search or post any bug.\r\n\r\n## Contributors\r\n\r\n* [Johan Hernandez](https://github.com/bithavoc) (https://github.com/bithavoc)\r\n* [Lars Jacob](https://github.com/jaclar) (https://github.com/jaclar)\r\n* [Jonathan Lomas](https://github.com/floatingLomas) (https://github.com/floatingLomas)\r\n* [Ross Brandes](https://github.com/rosston) (https://github.com/rosston)\r\n\r\nAlso see AUTHORS file, add yourself if you are missing.\r\n\r\n## MIT License\r\n\r\nCopyright (c) 2012-2014 Bithavoc.io and Contributors - http://bithavoc.io\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy\r\nof this software and associated documentation files (the \"Software\"), to deal\r\nin the Software without restriction, including without limitation the rights\r\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the Software is\r\nfurnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in\r\nall copies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\nFITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE\r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\nTHE SOFTWARE.\r\n",
  "google": "UA-54890957-1",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}