<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Express-winston by bithavoc</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Express-winston</h1>
        <p>express.js middleware for flatiron/winston</p>

        <p class="view"><a href="https://github.com/bithavoc/express-winston">View the Project on GitHub <small>bithavoc/express-winston</small></a></p>


        <ul>
          <li><a href="https://github.com/bithavoc/express-winston/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/bithavoc/express-winston/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/bithavoc/express-winston">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a id="express-winston" class="anchor" href="#express-winston" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>express-winston</h1>

<p><a href="https://www.npmjs.com/package/express-winston"><img src="https://img.shields.io/npm/dm/express-winston.svg" alt="Monthly Downloads"></a> <a href="http://travis-ci.org/bithavoc/express-winston"><img src="https://secure.travis-ci.org/bithavoc/express-winston.png" alt="Build Status"></a></p>

<blockquote>
<p><a href="https://github.com/flatiron/winston">winston</a> middleware for express.js</p>
</blockquote>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installation</h2>

<p>Newcomers should start with the latest branch which makes use of winston 1.x.x and supports node &gt;= 0.10:</p>

<pre><code>npm install express-winston
</code></pre>

<p>If you're already using express-winston, and want to stick with the stable version based on winston 0.9.x, you should instead do:</p>

<pre><code>npm install express-winston@0.x.x --save
</code></pre>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Usage</h2>

<p>express-winston provides middlewares for request and error logging of your express.js application.  It uses 'whitelists' to select properties from the request and (new in 0.2.x) response objects.</p>

<p>To make use of express-winston, you need to add the following to your application:</p>

<p>In <code>package.json</code>:</p>

<pre><code>{
  "dependencies": {
    "...": "...",
    "winston": "0.6.x",
    "express-winston": "0.2.x",
    "...": "..."
  }
}
</code></pre>

<p>In <code>server.js</code> (or wherever you need it):</p>

<pre><code>var winston = require('winston'),
    expressWinston = require('express-winston');
</code></pre>

<h3>
<a id="request-logging" class="anchor" href="#request-logging" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Request Logging</h3>

<p>Use <code>expressWinston.logger(options)</code> to create a middleware to log your HTTP requests.</p>

<div class="highlight highlight-source-js"><pre>    <span class="pl-k">var</span> router <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>./my-express-router<span class="pl-pds">'</span></span>);

    <span class="pl-smi">app</span>.<span class="pl-en">use</span>(<span class="pl-smi">expressWinston</span>.<span class="pl-en">logger</span>({
      transports<span class="pl-k">:</span> [
        <span class="pl-k">new</span> <span class="pl-en">winston.transports</span>.<span class="pl-en">Console</span>({
          json<span class="pl-k">:</span> <span class="pl-c1">true</span>,
          colorize<span class="pl-k">:</span> <span class="pl-c1">true</span>
        })
      ],
      meta<span class="pl-k">:</span> <span class="pl-c1">true</span>, <span class="pl-c">// optional: control whether you want to log the meta data about the request (default to true)</span>
      msg<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>HTTP {{req.method}} {{req.url}}<span class="pl-pds">"</span></span>, <span class="pl-c">// optional: customize the default logging message. E.g. "{{res.statusCode}} {{req.method}} {{res.responseTime}}ms {{req.url}}"</span>
      expressFormat<span class="pl-k">:</span> <span class="pl-c1">true</span>, <span class="pl-c">// Use the default Express/morgan request formatting, with the same colors. Enabling this will override any msg and colorStatus if true. Will only output colors on transports with colorize set to true</span>
      colorStatus<span class="pl-k">:</span> <span class="pl-c1">true</span>, <span class="pl-c">// Color the status code, using the Express/morgan color palette (default green, 3XX cyan, 4XX yellow, 5XX red). Will not be recognized if expressFormat is true</span>
      <span class="pl-en">ignoreRoute</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">req</span>, <span class="pl-smi">res</span>) { <span class="pl-k">return</span> <span class="pl-c1">false</span>; } <span class="pl-c">// optional: allows to skip some log messages based on request and/or response</span>
    }));

    <span class="pl-smi">app</span>.<span class="pl-en">use</span>(router); <span class="pl-c">// notice how the router goes after the logger.</span></pre></div>

<h4>
<a id="options" class="anchor" href="#options" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Options</h4>

<div class="highlight highlight-source-js"><pre>    transports<span class="pl-k">:</span> [<span class="pl-k">&lt;</span>WinstonTransport<span class="pl-k">&gt;</span>], <span class="pl-c">// list of all winston transports instances to use.</span>
    winstonInstance<span class="pl-k">:</span> <span class="pl-k">&lt;</span>WinstonLogger<span class="pl-k">&gt;</span>, <span class="pl-c">// a winston logger instance. If this is provided the transports option is ignored.</span>
    level<span class="pl-k">:</span> <span class="pl-c1">String</span>, <span class="pl-c">// log level to use, the default is "info".</span>
    msg<span class="pl-k">:</span> <span class="pl-c1">String</span> <span class="pl-c">// customize the default logging message. E.g. "{{res.statusCode}} {{req.method}} {{res.responseTime}}ms {{req.url}}", "HTTP {{req.method}} {{req.url}}".</span>
    expressFormat<span class="pl-k">:</span> <span class="pl-c1">Boolean</span>, <span class="pl-c">// Use the default Express/morgan request formatting, with the same colors. Enabling this will override any msg and colorStatus if true. Will only output colors on transports with colorize set to true</span>
    colorStatus<span class="pl-k">:</span> <span class="pl-c1">Boolean</span>, <span class="pl-c">// Color the status code, using the Express/morgan color palette (default green, 3XX cyan, 4XX yellow, 5XX red). Will not be recognized if expressFormat is true</span>
    meta<span class="pl-k">:</span> <span class="pl-c1">Boolean</span>, <span class="pl-c">// control whether you want to log the meta data about the request (default to true).</span>
    baseMeta<span class="pl-k">:</span> <span class="pl-c1">Object</span>, <span class="pl-c">// default meta data to be added to log, this will be merged with the meta data.</span>
    metaField<span class="pl-k">:</span> <span class="pl-c1">String</span>, <span class="pl-c">// if defined, the meta data will be added in this field instead of the meta root object.</span>
    statusLevels<span class="pl-k">:</span> <span class="pl-c1">Boolean</span> or <span class="pl-c1">Object</span> <span class="pl-c">// different HTTP status codes caused log messages to be logged at different levels (info/warn/error), the default is false. Use an object to control the levels various status codes are logged at.</span>
    <span class="pl-en">ignoreRoute</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">req</span>, <span class="pl-smi">res</span>) { <span class="pl-k">return</span> <span class="pl-c1">false</span>; } <span class="pl-c">// A function to determine if logging is skipped, defaults to returning false. Called _before_ any later middleware.</span>
    <span class="pl-en">skip</span><span class="pl-k">:</span> <span class="pl-k">function</span>(<span class="pl-smi">req</span>, <span class="pl-smi">res</span>) { <span class="pl-k">return</span> <span class="pl-c1">false</span>; } <span class="pl-c">// A function to determine if logging is skipped, defaults to returning false. Called _after_ response has already been sent.</span>
    <span class="pl-en">requestFilter</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">req</span>, <span class="pl-smi">propName</span>) { <span class="pl-k">return</span> req[propName]; } <span class="pl-c">// A function to filter/return request values, defaults to returning all values allowed by whitelist. If the function returns undefined, the key/value will not be included in the meta.</span>
    <span class="pl-en">responseFilter</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">res</span>, <span class="pl-smi">propName</span>) { <span class="pl-k">return</span> res[propName]; } <span class="pl-c">// A function to filter/return response values, defaults to returning all values allowed by whitelist. If the function returns undefined, the key/value will not be included in the meta.</span>
    requestWhitelist<span class="pl-k">:</span> [<span class="pl-c1">String</span>] <span class="pl-c">// Array of request properties to log. Overrides global requestWhitelist for this instance</span>
    responseWhitelist<span class="pl-k">:</span> [<span class="pl-c1">String</span>] <span class="pl-c">// Array of response properties to log. Overrides global responseWhitelist for this instance</span>
    bodyWhitelist<span class="pl-k">:</span> [<span class="pl-c1">String</span>] <span class="pl-c">// Array of body properties to log. Overrides global bodyWhitelist for this instance</span>
    bodyBlacklist<span class="pl-k">:</span> [<span class="pl-c1">String</span>] <span class="pl-c">// Array of body properties to omit from logs. Overrides global bodyBlacklist for this instance</span>
    ignoredRoutes<span class="pl-k">:</span> [<span class="pl-c1">String</span>] <span class="pl-c">// Array of paths to ignore/skip logging. Overrides global ignoredRoutes for this instance</span>
</pre></div>

<h3>
<a id="error-logging" class="anchor" href="#error-logging" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Error Logging</h3>

<p>Use <code>expressWinston.errorLogger(options)</code> to create a middleware that log the errors of the pipeline.</p>

<div class="highlight highlight-source-js"><pre>    <span class="pl-k">var</span> router <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>./my-express-router<span class="pl-pds">'</span></span>);

    <span class="pl-smi">app</span>.<span class="pl-en">use</span>(router); <span class="pl-c">// notice how the router goes first.</span>
    <span class="pl-smi">app</span>.<span class="pl-en">use</span>(<span class="pl-smi">expressWinston</span>.<span class="pl-en">errorLogger</span>({
      transports<span class="pl-k">:</span> [
        <span class="pl-k">new</span> <span class="pl-en">winston.transports</span>.<span class="pl-en">Console</span>({
          json<span class="pl-k">:</span> <span class="pl-c1">true</span>,
          colorize<span class="pl-k">:</span> <span class="pl-c1">true</span>
        })
      ]
    }));</pre></div>

<p>The logger needs to be added AFTER the express router(<code>app.router)</code>) and BEFORE any of your custom error handlers(<code>express.handler</code>). Since express-winston will just log the errors and not <strong>handle</strong> them, you can still use your custom error handler like <code>express.handler</code>, just be sure to put the logger before any of your handlers.</p>

<h4>
<a id="options-1" class="anchor" href="#options-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Options</h4>

<div class="highlight highlight-source-js"><pre>    transports<span class="pl-k">:</span> [<span class="pl-k">&lt;</span>WinstonTransport<span class="pl-k">&gt;</span>], <span class="pl-c">// list of all winston transports instances to use.</span>
    winstonInstance<span class="pl-k">:</span> <span class="pl-k">&lt;</span>WinstonLogger<span class="pl-k">&gt;</span>, <span class="pl-c">// a winston logger instance. If this is provided the transports option is ignored</span>
    msg<span class="pl-k">:</span> <span class="pl-c1">String</span> <span class="pl-c">// customize the default logging message. E.g. "{{res.statusCode}} {{req.method}} {{res.responseTime}}ms {{req.url}}", "HTTP {{req.method}} {{req.url}}".</span>
    baseMeta<span class="pl-k">:</span> <span class="pl-c1">Object</span>, <span class="pl-c">// default meta data to be added to log, this will be merged with the error data.</span>
    metaField<span class="pl-k">:</span> <span class="pl-c1">String</span>, <span class="pl-c">// if defined, the meta data will be added in this field instead of the meta root object.</span>
    <span class="pl-en">requestFilter</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">req</span>, <span class="pl-smi">propName</span>) { <span class="pl-k">return</span> req[propName]; } <span class="pl-c">// A function to filter/return request values, defaults to returning all values allowed by whitelist. If the function returns undefined, the key/value will not be included in the meta.</span>
    requestWhitelist<span class="pl-k">:</span> [<span class="pl-c1">String</span>] <span class="pl-c">// Array of request properties to log. Overrides global requestWhitelist for this instance</span>
    level<span class="pl-k">:</span> <span class="pl-c1">String</span> <span class="pl-c">// custom log level for errors (default is 'error')</span></pre></div>

<p>To use winston's existing transports, set <code>transports</code> to the values (as in key-value) of the <code>winston.default.transports</code> object. This may be done, for example, by using underscorejs: <code>transports: _.values(winston.default.transports)</code>.</p>

<p>Alternatively, if you're using a winston logger instance elsewhere and have already set up levels and transports, pass the instance into expressWinston with the <code>winstonInstance</code> option. The <code>transports</code> option is then ignored.</p>

<h2>
<a id="examples" class="anchor" href="#examples" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Examples</h2>

<div class="highlight highlight-source-js"><pre>    <span class="pl-k">var</span> express <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>express<span class="pl-pds">'</span></span>);
    <span class="pl-k">var</span> expressWinston <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>express-winston<span class="pl-pds">'</span></span>);
    <span class="pl-k">var</span> winston <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>winston<span class="pl-pds">'</span></span>); <span class="pl-c">// for transports.Console</span>
    <span class="pl-k">var</span> app <span class="pl-k">=</span> <span class="pl-c1">module</span>.<span class="pl-smi">exports</span> <span class="pl-k">=</span> <span class="pl-en">express</span>();

    <span class="pl-smi">app</span>.<span class="pl-en">use</span>(<span class="pl-smi">express</span>.<span class="pl-en">bodyParser</span>());
    <span class="pl-smi">app</span>.<span class="pl-en">use</span>(<span class="pl-smi">express</span>.<span class="pl-en">methodOverride</span>());

    <span class="pl-c">// Let's make our express `Router` first.</span>
    <span class="pl-k">var</span> router <span class="pl-k">=</span> <span class="pl-smi">express</span>.<span class="pl-en">Router</span>();
    <span class="pl-smi">router</span>.<span class="pl-en">get</span>(<span class="pl-s"><span class="pl-pds">'</span>/error<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">req</span>, <span class="pl-smi">res</span>, <span class="pl-smi">next</span>) {
      <span class="pl-c">// here we cause an error in the pipeline so we see express-winston in action.</span>
      <span class="pl-k">return</span> <span class="pl-en">next</span>(<span class="pl-k">new</span> <span class="pl-en">Error</span>(<span class="pl-s"><span class="pl-pds">"</span>This is an error and it should be logged to the console<span class="pl-pds">"</span></span>));
    });

    <span class="pl-smi">app</span>.<span class="pl-en">get</span>(<span class="pl-s"><span class="pl-pds">'</span>/<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">req</span>, <span class="pl-smi">res</span>, <span class="pl-smi">next</span>) {
      <span class="pl-smi">res</span>.<span class="pl-c1">write</span>(<span class="pl-s"><span class="pl-pds">'</span>This is a normal request, it should be logged to the console too<span class="pl-pds">'</span></span>);
      <span class="pl-smi">res</span>.<span class="pl-en">end</span>();
    });

    <span class="pl-c">// express-winston logger makes sense BEFORE the router.</span>
    <span class="pl-smi">app</span>.<span class="pl-en">use</span>(<span class="pl-smi">expressWinston</span>.<span class="pl-en">logger</span>({
      transports<span class="pl-k">:</span> [
        <span class="pl-k">new</span> <span class="pl-en">winston.transports</span>.<span class="pl-en">Console</span>({
          json<span class="pl-k">:</span> <span class="pl-c1">true</span>,
          colorize<span class="pl-k">:</span> <span class="pl-c1">true</span>
        })
      ]
    }));

    <span class="pl-c">// Now we can tell the app to use our routing code:</span>
    <span class="pl-smi">app</span>.<span class="pl-en">use</span>(router);

    <span class="pl-c">// express-winston errorLogger makes sense AFTER the router.</span>
    <span class="pl-smi">app</span>.<span class="pl-en">use</span>(<span class="pl-smi">expressWinston</span>.<span class="pl-en">errorLogger</span>({
      transports<span class="pl-k">:</span> [
        <span class="pl-k">new</span> <span class="pl-en">winston.transports</span>.<span class="pl-en">Console</span>({
          json<span class="pl-k">:</span> <span class="pl-c1">true</span>,
          colorize<span class="pl-k">:</span> <span class="pl-c1">true</span>
        })
      ]
    }));

    <span class="pl-c">// Optionally you can include your custom error handler after the logging.</span>
    <span class="pl-smi">app</span>.<span class="pl-en">use</span>(<span class="pl-smi">express</span>.<span class="pl-en">errorLogger</span>({
      dumpExceptions<span class="pl-k">:</span> <span class="pl-c1">true</span>,
      showStack<span class="pl-k">:</span> <span class="pl-c1">true</span>
    }));

    <span class="pl-smi">app</span>.<span class="pl-en">listen</span>(<span class="pl-c1">3000</span>, <span class="pl-k">function</span>(){
      <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">"</span>express-winston demo listening on port %d in %s mode<span class="pl-pds">"</span></span>, <span class="pl-v">this</span>.<span class="pl-en">address</span>().<span class="pl-c1">port</span>, <span class="pl-smi">app</span>.<span class="pl-smi">settings</span>.<span class="pl-smi">env</span>);
    });</pre></div>

<p>Browse <code>/</code> to see a regular HTTP logging like this:</p>

<pre><code>{
  "req": {
    "httpVersion": "1.1",
    "headers": {
      "host": "localhost:3000",
      "connection": "keep-alive",
      "accept": "*/*",
      "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_4) AppleWebKit/536.11 (KHTML, like Gecko) Chrome/20.0.1132.57 Safari/536.11",
      "accept-encoding": "gzip,deflate,sdch",
      "accept-language": "en-US,en;q=0.8,es-419;q=0.6,es;q=0.4",
      "accept-charset": "ISO-8859-1,utf-8;q=0.7,*;q=0.3",
      "cookie": "connect.sid=nGspCCSzH1qxwNTWYAoexI23.seE%2B6Whmcwd"
    },
    "url": "/",
    "method": "GET",
    "originalUrl": "/",
    "query": {}
  },
  "res": {
    "statusCode": 200
  },
  "responseTime" : 12,
  "level": "info",
  "message": "HTTP GET /favicon.ico"
}
</code></pre>

<p>Browse <code>/error</code> will show you how express-winston handles and logs the errors in the express pipeline like this:</p>

<pre><code>{
  "date": "Thu Jul 19 2012 23:39:44 GMT-0500 (COT)",
  "process": {
    "pid": 35719,
    "uid": 501,
    "gid": 20,
    "cwd": "/Users/thepumpkin/Projects/testExpressWinston",
    "execPath": "/usr/local/bin/node",
    "version": "v0.6.18",
    "argv": [
      "node",
      "/Users/thepumpkin/Projects/testExpressWinston/app.js"
    ],
    "memoryUsage": {
      "rss": 14749696,
      "heapTotal": 7033664,
      "heapUsed": 5213280
    }
  },
  "os": {
    "loadavg": [
      1.95068359375,
      1.5166015625,
      1.38671875
    ],
    "uptime": 498086
  },
  "trace": [
    ...,
    {
      "column": 3,
      "file": "Object].log (/Users/thepumpkin/Projects/testExpressWinston/node_modules/winston/lib/winston/transports/console.js",
      "function": "[object",
      "line": 87,
      "method": null,
      "native": false
    }
  ],
  "stack": [
    "Error: This is an error and it should be logged to the console",
    "    at /Users/thepumpkin/Projects/testExpressWinston/app.js:39:15",
    "    at callbacks (/Users/thepumpkin/Projects/testExpressWinston/node_modules/express/lib/router/index.js:272:11)",
    "    at param (/Users/thepumpkin/Projects/testExpressWinston/node_modules/express/lib/router/index.js:246:11)",
    "    at pass (/Users/thepumpkin/Projects/testExpressWinston/node_modules/express/lib/router/index.js:253:5)",
    "    at Router._dispatch (/Users/thepumpkin/Projects/testExpressWinston/node_modules/express/lib/router/index.js:280:4)",
    "    at Object.handle (/Users/thepumpkin/Projects/testExpressWinston/node_modules/express/lib/router/index.js:45:10)",
    "    at next (/Users/thepumpkin/Projects/testExpressWinston/node_modules/express/node_modules/connect/lib/http.js:204:15)",
    "    at done (/Users/thepumpkin/Dropbox/Projects/express-winston/index.js:91:14)",
    "    at /Users/thepumpkin/Dropbox/Projects/express-winston/node_modules/async/lib/async.js:94:25",
    "    at [object Object].log (/Users/thepumpkin/Projects/testExpressWinston/node_modules/winston/lib/winston/transports/console.js:87:3)"
  ],
  "req": {
    "httpVersion": "1.1",
    "headers": {
      "host": "localhost:3000",
      "connection": "keep-alive",
      "cache-control": "max-age=0",
      "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_4) AppleWebKit/536.11 (KHTML, like Gecko) Chrome/20.0.1132.57 Safari/536.11",
      "accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",
      "accept-encoding": "gzip,deflate,sdch",
      "accept-language": "en-US,en;q=0.8,es-419;q=0.6,es;q=0.4",
      "accept-charset": "ISO-8859-1,utf-8;q=0.7,*;q=0.3",
      "cookie": "connect.sid=nGspCCSzH1qxwNTWYAoexI23.seE%2B6WhmcwdzFEjqhMDuIIl3mAUY7dT4vn%2BkWvRPhZc"
    },
    "url": "/error",
    "method": "GET",
    "originalUrl": "/error",
    "query": {}
  },
  "level": "error",
  "message": "middlewareError"
}
</code></pre>

<h2>
<a id="global-whitelists-and-blacklists" class="anchor" href="#global-whitelists-and-blacklists" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Global Whitelists and Blacklists</h2>

<p>Express-winston exposes three whitelists that control which properties of the <code>request</code>, <code>body</code>, and <code>response</code> are logged:</p>

<ul>
<li><code>requestWhitelist</code></li>
<li>
<code>bodyWhitelist</code>, <code>bodyBlacklist</code>
</li>
<li><code>responseWhitelist</code></li>
</ul>

<p>For example, <code>requestWhitelist</code> defaults to:</p>

<pre><code>['url', 'headers', 'method', 'httpVersion', 'originalUrl', 'query'];
</code></pre>

<p>Only those properties of the request object will be logged. Set or modify the whitelist as necessary.</p>

<p>For example, to include the session property (the session data), add the following during logger setup:</p>

<pre><code>expressWinston.requestWhitelist.push('session');
</code></pre>

<p>The blacklisting excludes certain properties and keeps all others. If both <code>bodyWhitelist</code> and <code>bodyBlacklist</code> are set
the properties excluded by the blacklist are not included even if they are listed in the whitelist!</p>

<p>Example:</p>

<pre><code>expressWinston.bodyBlacklist.push('secretid', 'secretproperty');
</code></pre>

<p>Note that you can log the whole request and/or response body:</p>

<pre><code>expressWinston.requestWhitelist.push('body');
expressWinston.responseWhitelist.push('body');
</code></pre>

<h2>
<a id="route-specific-whitelists-and-blacklists" class="anchor" href="#route-specific-whitelists-and-blacklists" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Route-Specific Whitelists and Blacklists</h2>

<p>New in version 0.2.x is the ability to add whitelist elements in a route.  express-winston adds a <code>_routeWhitelists</code> object to the <code>req</code>uest, containing <code>.body</code>, <code>.req</code> and .res` properties, to which you can set an array of 'whitelist' parameters to include in the log, specific to the route in question:</p>

<div class="highlight highlight-source-js"><pre>    <span class="pl-smi">router</span>.<span class="pl-en">post</span>(<span class="pl-s"><span class="pl-pds">'</span>/user/register<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">req</span>, <span class="pl-smi">res</span>, <span class="pl-smi">next</span>) {
      <span class="pl-smi">req</span>.<span class="pl-smi">_routeWhitelists</span>.<span class="pl-c1">body</span> <span class="pl-k">=</span> [<span class="pl-s"><span class="pl-pds">'</span>username<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>email<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>age<span class="pl-pds">'</span></span>]; <span class="pl-c">// But not 'password' or 'confirm-password' or 'top-secret'</span>
      <span class="pl-smi">req</span>.<span class="pl-smi">_routeWhitelists</span>.<span class="pl-smi">res</span> <span class="pl-k">=</span> [<span class="pl-s"><span class="pl-pds">'</span>_headers<span class="pl-pds">'</span></span>];
    });</pre></div>

<p>Post to <code>/user/register</code> would give you something like the following:</p>

<pre><code>{
  "req": {
    "httpVersion": "1.1",
    "headers": {
      "host": "localhost:3000",
      "connection": "keep-alive",
      "accept": "*/*",
      "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_4) AppleWebKit/536.11 (KHTML, like Gecko) Chrome/20.0.1132.57 Safari/536.11",
      "accept-encoding": "gzip,deflate,sdch",
      "accept-language": "en-US,en;q=0.8,es-419;q=0.6,es;q=0.4",
      "accept-charset": "ISO-8859-1,utf-8;q=0.7,*;q=0.3",
      "cookie": "connect.sid=nGspCCSzH1qxwNTWYAoexI23.seE%2B6Whmcwd"
    },
    "url": "/",
    "method": "GET",
    "originalUrl": "/",
    "query": {},
    "body": {
      "username": "foo",
      "email": "foo@bar.com",
      "age": "72"
    }
  },
  "res": {
    "statusCode": 200
  },
  "responseTime" : 12,
  "level": "info",
  "message": "HTTP GET /favicon.ico"
}
</code></pre>

<p>Blacklisting supports only the <code>body</code> property.</p>

<div class="highlight highlight-source-js"><pre>    <span class="pl-smi">router</span>.<span class="pl-en">post</span>(<span class="pl-s"><span class="pl-pds">'</span>/user/register<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">req</span>, <span class="pl-smi">res</span>, <span class="pl-smi">next</span>) {
      <span class="pl-smi">req</span>.<span class="pl-smi">_routeWhitelists</span>.<span class="pl-c1">body</span> <span class="pl-k">=</span> [<span class="pl-s"><span class="pl-pds">'</span>username<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>email<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>age<span class="pl-pds">'</span></span>]; <span class="pl-c">// But not 'password' or 'confirm-password' or 'top-secret'</span>
      <span class="pl-smi">req</span>.<span class="pl-smi">_routeBlacklists</span>.<span class="pl-c1">body</span> <span class="pl-k">=</span> [<span class="pl-s"><span class="pl-pds">'</span>username<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>password<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>confirm-password<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>top-secret<span class="pl-pds">'</span></span>];
      <span class="pl-smi">req</span>.<span class="pl-smi">_routeWhitelists</span>.<span class="pl-smi">res</span> <span class="pl-k">=</span> [<span class="pl-s"><span class="pl-pds">'</span>_headers<span class="pl-pds">'</span></span>];
    });</pre></div>

<p>If both <code>req._bodyWhitelist.body</code> and <code>req._bodyBlacklist.body</code> are set the result will be the white listed properties
excluding any black listed ones. In the above example, only 'email' and 'age' would be included.</p>

<h2>
<a id="custom-status-levels" class="anchor" href="#custom-status-levels" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Custom Status Levels</h2>

<p>If you set statusLevels to true express-winston will log sub 400 responses at info level, sub 500 responses as warnings and 500+ responses as errors. To change these levels specify an object as follows</p>

<div class="highlight highlight-source-json"><pre>  <span class="pl-s"><span class="pl-pds">"</span>statusLevels<span class="pl-pds">"</span></span>: {
    <span class="pl-s"><span class="pl-pds">"</span>success<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>debug<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>warn<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>debug<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>error<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>info<span class="pl-pds">"</span></span>
  }</pre></div>

<h2>
<a id="tests" class="anchor" href="#tests" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Tests</h2>

<p>Run the basic Mocha tests:</p>

<pre><code>npm test
</code></pre>

<p>Run the Travis-CI tests (which will fail with &lt; 100% coverage):</p>

<pre><code>npm run test-travis
</code></pre>

<p>Generate the <code>coverage.html</code> coverage report:</p>

<pre><code>npm run test-coverage
</code></pre>

<h2>
<a id="issues-and-collaboration" class="anchor" href="#issues-and-collaboration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Issues and Collaboration</h2>

<p>If you ran into any problems, please use the project <a href="https://github.com/bithavoc/express-winston/issues">Issues section</a> to search or post any bug.</p>

<h2>
<a id="contributors" class="anchor" href="#contributors" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Contributors</h2>

<ul>
<li>
<a href="https://github.com/bithavoc">Johan Hernandez</a> (<a href="https://github.com/bithavoc">https://github.com/bithavoc</a>)</li>
<li>
<a href="https://github.com/jaclar">Lars Jacob</a> (<a href="https://github.com/jaclar">https://github.com/jaclar</a>)</li>
<li>
<a href="https://github.com/floatingLomas">Jonathan Lomas</a> (<a href="https://github.com/floatingLomas">https://github.com/floatingLomas</a>)</li>
<li>
<a href="https://github.com/rosston">Ross Brandes</a> (<a href="https://github.com/rosston">https://github.com/rosston</a>)</li>
</ul>

<p>Also see AUTHORS file, add yourself if you are missing.</p>

<h2>
<a id="mit-license" class="anchor" href="#mit-license" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>MIT License</h2>

<p>Copyright (c) 2012-2014 Bithavoc.io and Contributors - <a href="http://bithavoc.io">http://bithavoc.io</a></p>

<p>Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:</p>

<p>The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.</p>

<p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.</p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/bithavoc">bithavoc</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-54890957-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
